# Laravel API Fetcher and Database Storage

## Описание проекта
Этот проект представляет собой Laravel-приложение, которое подключается к API, извлекает данные в формате JSON с различных эндпоинтов (`stocks`, `incomes`, `orders`, `sales`), преобразует их и сохраняет в базу данных MySQL. Приложение разработано с использованием сервисного подхода для легкости сопровождения и масштабируемости.

---

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/DenEvtifeev/wb-api-project
   cd <repository_folder>
   
2. Установите Docker

3. разверните контейнеры 
    ```
   docker-compose up -d
   
   параметр -d обязателен, так как консоль будет необходима
   //вход в контейнер app
   docker exec -it wb-api-app bash



## Комментарии по проекту.
При первом запуске обязательно выполните вручную команду php artisan api:fetch-data {account_id}. после выполнения скрипта создастся json файл состояния fetch_data_state.json, в котором будет записано состояние выполнения скрипта и account_id, эти параметры необходимы для корректной работы планировщика задач и автоматической отправки запросов.

Если вы ходите сменить пользователя, для которого будет производиться выгрузка данных с api, удалите файл состояния по пути: storage\app\fetch_data_state.json, затем используйте команду api:fetch-data {account_id?} с новым account_id, который вам нужен.

При первом запуске команды фетчинг данных будет происходить за период от сегодняшнего дня прошлого года до сегодняшнего дня нынешнего года. При последующих запусках команды запросы будут обновлять данные за текущий и следующий день

Список команд, доступных для использования:
(ВАЖНО! все команды выполняются внутри контейнера app. все команды начинаются с php artisan, например php artisan api:fetch-data {account_id} или php artisan add:token-type {name})
1. api:fetch-data {account_id?} производит выгрузку файлов с определенного апи, который прикреплен к account_id
2. add:account {name} {company_id?} {token_id?} {api_service_id?} производит добавление нового аккаунта в базу данных
3. add:api-service {name} {base_url} {fetch_url} производит добавление нового апи-сервиса в базу данных
4. add:company {name} добавляет компанию, к которой относится аккаунт
5. add:token {token} {token_type_id} производит добавление нового токена в базу данных
6. add:token-type {name} производит добавление нового типа токена в базу данных

Для корректного добавления новых аккаунтов последовательность выполнения команд следующая:
    ```bash

    add:token-type {name}
    add:token {token} {token_type_id}
    add:company {name}
    add:api-service {name} {base_url} {fetch_url}
    add:account {name} {company_id?} {token_id?} {api_service_id?}

Планировщик задач настроен на выполнение команды api:fetch-data {account_id?} на 21:00 и 9:00
